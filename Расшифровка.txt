Расшифровка стрелок на схеме:
HTTP Запрос (запуск, CRUD): Пользователь через фронтенд инициирует действие (запуск симуляции, создание/обновление объекта).
Валидация данных: API-слой (routes) передает полученные данные в forms.py для проверки.
Обработать данные: forms.py вызывает универсальный сервис object_service для выполнения операции с БД.
Запись/Чтение в БД: object_service выполняет SQL-запросы к базе данных через ORM-модели.
Запуск симуляции: API-слой вызывает simulation_manager.run, передавая ему все параметры.
Выполнить симуляцию: simulation_manager запускает основной исполнительный модуль simulate.py.
7a. Запрос плана (авто-режим): simulate запрашивает у planner оптимальный план работы техники.
7b. Расчеты (движение, время): simulate вызывает математические функции из core/calculations для моделирования процессов.
7c. Изменение состояний: simulate изменяет состояния техники (MOVING -> LOADING), используя справочник states.
Отправка телеметрии: simulate на каждом шаге передает данные о состоянии техники в telemetry_emitter.
Сохранить результаты (Redis): telemetry_emitter сохраняет сгенерированную телеметрию в Redis для последующего доступа.
Событие (поломка) -> Перестроить план: simulate при возникновении критического события (например, поломка) может запросить у planner перестроение плана.
Запрос данных для UI: API-слой запрашивает у quarry_data_service агрегированные данные для отображения на фронтенде.
Агрегация из БД: quarry_data_service собирает данные из разных таблиц (техника, дороги и т.д.) в единую структуру.
Запрос времени/смен: API-слой запрашивает у date_time_service информацию о сменах или текущем времени.
Расчет смен: date_time_service использует логику из shift.py для расчета рабочих смен.
Загрузка файла (DXF): Пользователь загружает DXF-файл по API.
Конвертация DXF -> GeoJSON: forms.py вызывает dxf_converter для преобразования загруженного файла.
Результат в БД (MapOverlay): Результат конвертации (GeoJSON) сохраняется в БД как часть объекта MapOverlay.