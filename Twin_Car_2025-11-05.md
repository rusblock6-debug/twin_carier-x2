### ORM модели (SQLAlchemy)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| Base | ORM модель домена | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| BaseObject | Абстрактная базовая модель для объектов | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| BaseVehicle | Абстрактная базовая модель для транспортных средств | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| Blasting | Расписание взрывов с геозоной | ORM через API (/api/object, /api/file, delete-роуты) | БД | ScheduleDataService, SimDataSerializer | Блокировки зон/окна времени |
| DefaultValuesMixin | Миксин для сбора значений по умолчанию | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| FuelStation | Заправка | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → SimDataSerializer | Время заправок/задержки |
| FuelStationArgsMixin | Основные параметры заправки для обсчёта симуляции | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| FuelStationTemplate | Шаблон заправки | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| IdleArea | Зоны ожидания (обед/смена/взрыв/ремонт) | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → SimDataSerializer | Стоянки/ограничения движения |
| LocationMixin | Миксин для локации | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| MapOverlay | Подложка карты (GeoJSON/цвет/якорь) | ORM через API (/api/object, /api/file, delete-роуты) | БД | API /api/map-overlay, QuarryDataService | Отображение карты в UI |
| PlannedIdle | Плановые простои техники (generic FK) | ORM через API (/api/object, /api/file, delete-роуты) | БД | ScheduleDataService, SimDataSerializer | Недоступности техники во времени |
| Quarry | Карьер: конфигурация смен, часовой пояс, связи с объектами | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → API → SimDataSerializer | Тайминг симуляции, обеды/пересменки, фильтр объектов |
| RoadNet | Дорожная сеть (GeoJSON) | ORM через API (/api/object, /api/file, delete-роуты) | БД | API /api/road-net, SimDataSerializer | Топология дорог |
| Scenario | Сценарий моделирования (окна времени, распределение АС, метрики стабильности) | ORM через API (/api/object, /api/file, delete-роуты) | БД | GetSimIdService → SimulationManager | Состав участников и запуск симуляций |
| Shovel | Экскаватор с ТТХ и координатой | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → SimDataSerializer | Время цикла погрузки/производительность |
| ShovelArgsMixin | Основные параметры экскаватора для обсчёта симуляции | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| ShovelTemplate | Шаблон экскаватора | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| Trail | Маршрут Shovel—Unload (raw_graph) | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService (segments, trucks) | Геометрия/назначение маршрутов |
| TrailTruckAssociation | M2M сценарий—маршрут—самосвал | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService | Какие грузовики на каких трассах |
| Truck | Самосвал с топливной моделью | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → SimDataSerializer | Скорости/топливо/ремонты/выработка |
| TruckArgsMixin | Основные параметры самосвала для обсчёта симуляции | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| TruckTemplate | Шаблон самосвала | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| Unload | Пункт разгрузки | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService → SimDataSerializer | Пропускная способность разгрузки |
| UnloadArgsMixin | Основные параметры пункта разгрузки для обсчёта симуляции | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| UnloadTemplate | Шаблон пункта разгрузки | ORM через API (/api/object, /api/file, delete-роуты) | БД | QuarryDataService/сервисы → API/сериализатор | Состав и параметры предметных сущностей |
| UploadedFile | Файл в сторидже | ORM через API (/api/object, /api/file, delete-роуты) | БД | Связан с MapOverlay | Жизненный цикл файлов |

### Pydantic-схемы (формы API)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| BaseObjectSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| BaseVehicleSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| BlastingSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| FuelStationArgsMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| FuelStationSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| FuelStationTemplateSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| IdleAreaSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| LocationMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| MapOverlaySchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ObjectActionRequest | Обёртка запроса create/update | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | В ObjectService | Диспетчинг по типам |
| PlannedIdleSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| QuarryRefMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| QuarrySchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| RoadNetSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ScenarioSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ScheduleMixin | Методы для создания/удаления расписаний. Эти методы возвращают JSONResponse (чтобы удобно использовать в FastAPI). | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ShovelArgsMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ShovelSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| ShovelTemplateSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TemplateMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TemplateRefMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TrailSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TruckArgsMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TruckSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| TruckTemplateSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| UnloadArgsMixin | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| UnloadSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |
| UnloadTemplateSchema | Валидация/маппинг входных данных | Создаются в ObjectService при обработке HTTP JSON | HTTP JSON | ObjectService → ORM | Корректность записи и постпроцессы |

### Сервисы и DAO

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| AllTemplatesDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| AllTemplatesListService | Собирает все шаблоны в словарь списков и возвращает DTO. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| BaseObjectService | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| GenericObjectService | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| GetSimIdService | Основной сервис симуляции — собирает данные, запускает SimulationManager и сохраняет результат. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ObjectDAO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ObjectService | Диспетчер create/update/delete по типам | Создаются в роутере/других сервисах | БД/Redis/входные параметры | ORM запись/обновление | Бизнес-логика сохранения |
| QuarryDAO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| QuarryDataDTO | DTO, возвращаемый сервисом — содержит список карьеров в виде словарей. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| QuarryDataService | Компоновка ответа /api/quarry-data | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → API | Полный срез карьеров |
| ScenarioDAO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScenarioDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScenarioObjectService | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScenarioService | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScheduleDAO | DAO для выборки расписания из БД. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScheduleDataResponseDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScheduleDataService | Сервис для получения расписания по дате и смене или временному диапазону. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScheduleItemDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ScheduleObjectService | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| ShiftDetailsDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| SimulationDAO | Работа с базой данных для симуляции. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| SimulationRequestDTO | Модель запроса для запуска симуляции. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| StartEndTimeDTO | DTO содержит времена в UTC. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| StartEndTimeGenerateService | Генерирует начало/конец рабочего дня в часовом поясе предприятия и возвращает их в UTC. По умолчанию берёт таймзону из окружения TZ, иначе '… | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| TemplateDAO | DAO для получения моделей из БД. | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |
| TrailDTO | Сервис/DAO бизнес-логики | Создаются в роутере/других сервисах | БД/Redis/входные параметры | DTO → роуты/API | Агрегация/правила бизнес-логики |

### Симдвижок: входные датаклассы

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| ActualTrip | Фактический рейс (телеметрия) | Создаются в SimDataSerializer | JSON из API/БД | В writer | Экспорт результатов |
| Blasting | Расписание взрывов с геозоной | Создаются в SimDataSerializer | JSON из API/БД | ScheduleDataService, SimDataSerializer | Блокировки зон/окна времени |
| FuelStation | Заправка | Создаются в SimDataSerializer | JSON из API/БД | QuarryDataService → SimDataSerializer | Время заправок/задержки |
| FuelStationProperties | Параметры заправки | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Скорость заправки/очереди |
| IdleArea | Зоны ожидания (обед/смена/взрыв/ремонт) | Создаются в SimDataSerializer | JSON из API/БД | QuarryDataService → SimDataSerializer | Стоянки/ограничения движения |
| IdleAreaStorage | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| PlannedIdle | Плановые простои техники (generic FK) | Создаются в SimDataSerializer | JSON из API/БД | ScheduleDataService, SimDataSerializer | Недоступности техники во времени |
| PlannedTrip | План рейса | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию/планировщик | Маршрутизация/очередность |
| Point | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| QuarryObject | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| Route | Маршрут (сегменты и привязки) | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Геометрия пути |
| Segment | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| ShiftChangeArea | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| Shovel | Экскаватор с ТТХ и координатой | Создаются в SimDataSerializer | JSON из API/БД | QuarryDataService → SimDataSerializer | Время цикла погрузки/производительность |
| ShovelProperties | ТТХ экскаватора | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Цикл погрузки |
| SimData | Входная конфигурация симуляции | Создаются в SimDataSerializer | JSON из API/БД | В SimulationManager/симулятор | Все аспекты моделирования |
| TripData | Датакласс симдвижка | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Динамика моделирования |
| Truck | Самосвал с топливной моделью | Создаются в SimDataSerializer | JSON из API/БД | QuarryDataService → SimDataSerializer | Скорости/топливо/ремонты/выработка |
| TruckProperties | ТТХ самосвала | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Скорости/топливо/ремонты |
| Unload | Пункт разгрузки | Создаются в SimDataSerializer | JSON из API/БД | QuarryDataService → SimDataSerializer | Пропускная способность разгрузки |
| UnlProperties | ТТХ разгрузки | Создаются в SimDataSerializer | JSON из API/БД | В симуляцию | Пропускная способность |

### Симдвижок: менеджер/вывод

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| BatchWriter | Запись батчей и событий | Создаётся в SimulationManager | События/результаты симуляции | Redis → API чтения | Доступность результатов |
| DictReliabilityWriter | Запись результатов симуляции | Создаётся в SimulationManager | События/результаты симуляции | Redis/внешние потребители | Доступность/формат результатов |
| DictSimpleWriter | Запись результатов симуляции | Создаётся в SimulationManager | События/результаты симуляции | Redis/внешние потребители | Доступность/формат результатов |
| IManagerValidator | Оркестрация запуска симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| IWriter | Запись результатов симуляции | Создаётся в SimulationManager | События/результаты симуляции | Redis/внешние потребители | Доступность/формат результатов |
| ManagerValidationError | Любые ошибки валидации для менеджера | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| RawSimDataValidator | Оркестрация запуска симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| SimConfigOptionsValidator | Оркестрация запуска симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| SimConfigValidationError | Ошибка валидации конфигурации симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| SimDataValidationError | Ошибка валидации входных данных симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| SimulationManager | Сборка конфига и запуск симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Успешность старта/пакеты |
| SimWriterValidationError | Ошибка валидации писаря результатов симуляции | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |
| ValidatorValidationError | Ошибка валидации валидатора, используемого в менеджере | Создаётся в роуте запуска симуляции | Запрос/конфиг/Writer | Инициация симдвижка | Старт/конфигурация симуляции |

### Симдвижок: состояния/события/поведения

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| Event | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| EventType | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| ExcState | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| FuelStationEvent | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| FuelStationState | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| TruckState | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |
| UnloadState | Состояния/события/поведения симуляции | Императивно внутри симуляции | Внутренние данные симуляции | Внутренний цикл симуляции | Переходы состояний/ограничения |

### Планировщик и расчёты (планировщик отдельно)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| CPSolver | Планировщик/сольвер/входные данные планирования | Создаются планировщиком | InputPlanningData/SimData | Планировщик → симуляция | Качество/очередность рейсов |
| GreedySolver | Планировщик/сольвер/входные данные планирования | Создаются планировщиком | InputPlanningData/SimData | Планировщик → симуляция | Качество/очередность рейсов |
| InputPlanningData | Планировщик/сольвер/входные данные планирования | Создаются планировщиком | InputPlanningData/SimData | Планировщик → симуляция | Качество/очередность рейсов |
| MILPSolver | Планировщик/сольвер/входные данные планирования | Создаются планировщиком | InputPlanningData/SimData | Планировщик → симуляция | Качество/очередность рейсов |
| Planner | Планировщик/сольвер/входные данные планирования | Создаются планировщиком | InputPlanningData/SimData | Планировщик → симуляция | Качество/очередность рейсов |

### Планировщик и расчёты (расчётные блоки)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| BreakdownCalc | Расчеты Поломок/Восстановлений | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |
| FuelCalc | Расчётные блоки симуляции | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |
| LunchCalc | Расчёты времён обеденных перерывов | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |
| ShovelCalc | Расчётные блоки симуляции | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |
| TruckCalc | Расчётные блоки симуляции | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |
| UnloadCalc | Расчётные блоки симуляции | Используются внутри симуляции | ТТХ/события | Симуляция | Тайминги/ресурсы |

### Pydantic DTO роутов

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| DeleteObjectRequest | DTO/валидатор роутов | Инициализируются роутами FastAPI | HTTP JSON/параметры запроса | Маршруты FastAPI | Формат/валидность входа/выхода |
| QuarryDataResponse | DTO/валидатор роутов | Инициализируются роутами FastAPI | HTTP JSON/параметры запроса | Маршруты FastAPI | Формат/валидность входа/выхода |
| ScheduleDataRequest | DTO/валидатор роутов | Инициализируются роутами FastAPI | HTTP JSON/параметры запроса | Маршруты FastAPI | Формат/валидность входа/выхода |
| TimeRange | DTO/валидатор роутов | Инициализируются роутами FastAPI | HTTP JSON/параметры запроса | Маршруты FastAPI | Формат/валидность входа/выхода |
| UpdateLocationRequest | DTO/валидатор роутов | Инициализируются роутами FastAPI | HTTP JSON/параметры запроса | Маршруты FastAPI | Формат/валидность входа/выхода |

### Прочее (DXF конвертер)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| DXFConverter | Конвертер DXF → GeoJSON | Вызывается схемой MapOverlaySchema | Загруженные файлы | MapOverlay.geojson_data | Отрисовка подложек |

### Прочее (логирование)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| JsonFormatter | Логирование | Инициализируется при запуске | Логи симуляции | Логи | Диагностика |
| Logger | Логирование | Инициализируется при запуске | Логи симуляции | Логи | Диагностика |

### Прочее (некатегоризированные)

| Класс | Назначение в бизнес-логике | Как создаётся | Источник данных | Потоки данных (куда передаётся) | На что влияет |
|---|---|---|---|---|---|
| BaseBehavior | Абстрактный базовый класс для всех поведений в симуляции. Определяет общий интерфейс и шаблоны выполнения. | - | - | - | - |
| BaseTickBehavior | Класс определяющий базовую последовательность в логике расчетов каждый тик(фрейм) Этапы: 1. Расчеты для состояния актора. Метод state_proces… | - | - | - | - |
| BreakdownBehavior | Класс вычисляющий Поломки/Восстановления | - | - | - | - |
| DataclassEnumSerializerMixin | - | - | - | - | - |
| DataValidateError | - | - | - | - | - |
| DependencyResolver | - | - | - | - | - |
| FuelBehavior | Класс Управляющий топливом | - | - | - | - |
| FuelStation | Заправка | - | - | QuarryDataService → SimDataSerializer | Время заправок/задержки |
| IdleAreaService | Сервис, предоставляющий операции для работы с площадками простоев | - | - | - | - |
| IdleAreaType | - | - | - | - | - |
| InputPlanningData | - | - | - | - | - |
| LunchBehavior | Класс для техники, управляющий отслеживанием обедов и запуском обеденного простоя | - | - | - | - |
| ObjectType | - | - | - | - | - |
| PayloadType | - | - | - | - | - |
| PlannedIdleBehavior | Класс для техники, управляющий отслеживанием и запуском запланированных простоев | - | - | - | - |
| Point | - | - | - | - | - |
| QSimEnvironment | - | - | - | - | - |
| Quarry | Карьер: конфигурация смен, часовой пояс, связи с объектами | - | - | QuarryDataService → API → SimDataSerializer | Тайминг симуляции, обеды/пересменки, фильтр объектов |
| QuarryBlastingWatcher | Класс для карьера (Quarry), отслеживающий периоды взрывных работ и формирующий активные зоны | - | - | - | - |
| RoadNetCleaner | - | - | - | - | - |
| Route | Маршрут (сегменты и привязки) | - | - | В симуляцию | Геометрия пути |
| RouteEdge | - | - | - | - | - |
| RunSimulationError | - | - | - | - | - |
| ServiceLocator | - | - | - | - | - |
| ShiftConfigDataException | Ошибки данных (например 'Quarry not found', 'shift not found' и т.п.). | - | - | - | - |
| ShiftConfigException | Базовое исключение для ошибок конфигурации смен. | - | - | - | - |
| ShiftConfigParseException | Парсинговые ошибки (дата/время и т.п.). | - | - | - | - |
| ShiftConfigSchemaException | Ошибки схемы/структуры (оставляем на будущее). | - | - | - | - |
| ShiftDTO | - | - | - | - | - |
| ShiftLogic | - | - | - | - | - |
| ShiftOffsetsDTO | - | - | - | - | - |
| Shovel | Экскаватор с ТТХ и координатой | - | - | QuarryDataService → SimDataSerializer | Время цикла погрузки/производительность |
| ShovelBlastingWatcher | Класс для экскаватора (Shovel). Отслеживает наличие хотя бы одного возможного маршрута хотя бы до одного ПРа. Если ни одного маршрута нет - … | - | - | - | - |
| SimContext | Контекст(контейнер) содержащий в себе объекты симуляции | - | - | - | - |
| TelemetryEmitter | - | - | - | - | - |
| TrailType | - | - | - | - | - |
| TripService | - | - | - | - | - |
| TripStartTimeNotDefinedException | - | - | - | - | - |
| Truck | Самосвал с топливной моделью | - | - | QuarryDataService → SimDataSerializer | Скорости/топливо/ремонты/выработка |
| TruckBlastingWatcher | Класс для самосвала (Truck) Отслеживает ожидание проведения взрывных работ для самосвала. Если самосвал встал в ожидание - исключим его из п… | - | - | - | - |
| Unload | Пункт разгрузки | - | - | QuarryDataService → SimDataSerializer | Пропускная способность разгрузки |
| UnloadBlastingWatcher | Класс для пункта разгрузки (Unload). Отслеживает наличие хотя бы одного возможного маршрута хотя бы до одного экскаватора. Если ни одного ма… | - | - | - | - |
| UnloadType | - | - | - | - | - |

### Связи и граф потоков (высокоуровнево)

| Откуда | Куда | Тип данных | Триггер/событие |
|---|---|---|---|
| UI/API (POST /api/object) | ObjectService → Generic/Schedule/Scenario services | JSON формы объекта/расписания | Пользователь создаёт/обновляет сущность |
| ObjectService | ORM (SQLAlchemy) / БД | Маппинг полей и m2m-связей | Валидация формы прошла успешно |
| UI/API (GET /api/quarry-data) | QuarryDataService | Запрос витрины | Открытие UI/обновление данных |
| QuarryDataService | API ответ (/api/quarry-data) | Собранные объекты, маршруты, оверлеи | Успешные выборки из БД |
| UI/API (POST /api/run-simulation) | GetSimIdService | SimulationRequestDTO | Пользователь запускает симуляцию |
| GetSimIdService | SimulationDAO (road_net, schedules) | Идентификаторы/фильтры → ORM | Подготовка входа |
| SimulationDAO + входные данные | SimDataSerializer | Комбинированный JSON | Сбор готов к сериализации |
| SimDataSerializer | SimulationManager | SimData (датаклассы) | Валидация сериализованных данных |
| SimulationManager | BatchWriter | Сводки/события/батчи | Итерации симуляции/батч-комплит |
| BatchWriter | Redis | meta, summary, events, batches | Буфер заполнен/таймер |
| API (/api/simulation/*) | Redis | Чтение ключей симуляции | UI запрашивает прогресс/итоги |
| UI/API (POST /api/file) | UploadedFile + ФС | Бинарный файл | Пользователь загружает файл |
| MapOverlaySchema.convert_dxf | MapOverlay.geojson_data | GeoJSON из DXF | Создание/обновление подложки |
| UI/API (GET /api/schedule-data-by-date-shift) | ScheduleDataService | date, quarry_id, type, shift | Фильтрация слоёв расписаний |
